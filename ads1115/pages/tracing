<!DOCTYPE html>
<html lang="en" dir="ltr" class="no-js">
<head>
    <meta charset="utf-8" />
    <title>realtime:documentation:howto:tools:cyclictest:tracing [Wiki]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="theme-color" content="#008800"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="realtime,documentation,howto,tools,cyclictest,tracing"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki"/>
<link rel="start" href="/"/>
<link rel="contents" href="/realtime/documentation/howto/tools/cyclictest/tracing?do=index" title="Sitemap"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="/feed.php?mode=list&amp;ns=realtime:documentation:howto:tools:cyclictest"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="/_export/xhtml/realtime/documentation/howto/tools/cyclictest/tracing"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="/_export/raw/realtime/documentation/howto/tools/cyclictest/tracing"/>
<link rel="canonical" href="https://wiki.linuxfoundation.org/realtime/documentation/howto/tools/cyclictest/tracing"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=dokuwiki&amp;tseed=3abf20f179d49a827de0782976186dc4"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='realtime:documentation:howto:tools:cyclictest';var JSINFO = {"plugins":{"edittable":{"default columnwidth":""}},"plugin_folded":{"hide":"hide","reveal":"reveal"},"id":"realtime:documentation:howto:tools:cyclictest:tracing","namespace":"realtime:documentation:howto:tools:cyclictest","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=dokuwiki&amp;tseed=3abf20f179d49a827de0782976186dc4"></script>
<script type="text/javascript">/*<![CDATA[*/document.documentElement.className += ' olCSSsupported';
/*!]]>*/</script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="/lib/tpl/dokuwiki/images/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/dokuwiki/images/apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="#dokuwiki__content">skip to content</a></li>
        </ul>

        <h1><a href="/start"  accesskey="h" title="[H]"><img src="/_media/wiki/logo.png" width="200" height="64" alt="" /> <span>Wiki</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">User Tools</h3>
                <ul>
                    <li class="action login"><a href="/realtime/documentation/howto/tools/cyclictest/tracing?do=login&amp;sectok=" title="Log In" rel="nofollow"><span>Log In</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10 17.25V14H3v-4h7V6.75L15.25 12 10 17.25M8 2h9a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-4h2v4h9V4H8v4H6V4a2 2 0 0 1 2-2z"/></svg></a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Site Tools</h3>
            <form action="/start" method="get" role="search" class="search doku_form" id="dw__search" accept-charset="utf-8"><input type="hidden" name="do" value="search" /><input type="hidden" name="id" value="realtime:documentation:howto:tools:cyclictest:tracing" /><div class="no"><input name="q" type="text" class="edit" title="[F]" accesskey="f" placeholder="Search" autocomplete="on" id="qsearch__in" value="" /><button value="1" type="submit" title="Search">Search</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="/doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="realtime:documentation:howto:tools:cyclictest:tracing" /><select name="do" class="edit quickselect" title="Tools"><option value="">Tools</option><optgroup label="Page Tools"><option value="edit">Show pagesource</option><option value="revisions">Old revisions</option><option value="menuitemfolded">Fold/unfold all</option><option value="backlink">Backlinks</option></optgroup><optgroup label="Site Tools"><option value="recent">Recent Changes</option><option value="media">Media Manager</option><option value="index">Sitemap</option></optgroup><optgroup label="User Tools"><option value="login">Log In</option></optgroup></select><button type="submit">&gt;</button></div></form>            </div>
            <ul>
                <li class="action recent"><a href="/realtime/documentation/howto/tools/cyclictest/tracing?do=recent" title="Recent Changes [r]" rel="nofollow" accesskey="r">Recent Changes</a></li><li class="action media"><a href="/realtime/documentation/howto/tools/cyclictest/tracing?do=media&amp;ns=realtime%3Adocumentation%3Ahowto%3Atools%3Acyclictest" title="Media Manager" rel="nofollow">Media Manager</a></li><li class="action index"><a href="/realtime/documentation/howto/tools/cyclictest/tracing?do=index" title="Sitemap [x]" rel="nofollow" accesskey="x">Sitemap</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                                        <div class="trace"><span class="bchead">Trace:</span> <span class="bcsep">•</span> <span class="curid"><bdi><a href="/realtime/documentation/howto/tools/cyclictest/tracing"  class="breadcrumbs" title="realtime:documentation:howto:tools:cyclictest:tracing">tracing</a></bdi></span></div>
                    </div>
    


    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>realtime:documentation:howto:tools:cyclictest:tracing</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#cyclictest_-_latency_debugging_with_tracing">Cyclictest - Latency debugging with tracing</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#break_trace_option">Break Trace Option</a></div></li>
<li class="level2"><div class="li"><a href="#selecting_instrumentation">Selecting Instrumentation</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#function_tracing">Function Tracing</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#latency_tracing">Latency Tracing</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#measuring_the_tracing_overhead">Measuring the Tracing Overhead</a></div></li>
<li class="level3"><div class="li"><a href="#producing_a_trace">Producing a Trace</a></div></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="cyclictest_-_latency_debugging_with_tracing">Cyclictest - Latency debugging with tracing</h1>
<div class="level1">

<p>
Tracing is useful when trying to determine the cause of a latency because it can reveal relevant details about execution. There are several options in Cyclictest that can be used to capture traces in combination with Ftrace.
</p>

<p>
Information about how to set up Ftrace as well as how to view traces taken with Ftrace can be found <a href="/realtime/documentation/howto/tools/ftrace" class="wikilink1" title="realtime:documentation:howto:tools:ftrace">here</a>.
</p>
<hr />

</div>

<h2 class="sectionedit2" id="break_trace_option">Break Trace Option</h2>
<div class="level2">

<p>
A trace can be collected through Cyclictest by using the break trace (–breaktrace) option together with the –tracemark option. These options will stop tracing and end Cyclictest if it detects a latency that is longer than a specified limit. The ftrace must be started before Cyclictest is executed.
</p>

</div>

<h2 class="sectionedit3" id="selecting_instrumentation">Selecting Instrumentation</h2>
<div class="level2">

<p>
Ftrace provides a selection of tracers and instrumentation. These options are described in the Ftrace documentation <a href="/realtime/documentation/howto/tools/ftrace" class="wikilink1" title="realtime:documentation:howto:tools:ftrace">here</a>. The most important things to keep in mind when choosing instrumentation are the trace detail and the resulting overhead. A trace with more detail will require a higher overhead. In general, it is effective to corner the source of the latency over several iterations of tracing and analysis while gradually increasing the trace detail. Start with a small amount of instrumentation, which produces a simple trace. One good option would be to start by eliminating the most obvious possible sources of latency by tracing when interrupts or preemption are disabled.
</p>

</div>

<h3 class="sectionedit4" id="function_tracing">Function Tracing</h3>
<div class="level3">

<p>
It can sometimes be tempting to immediately jump to enabling function tracing. A full function trace is highly detailed because it includes all of the function calls that were made in the kernel. Function tracing can be very useful in the debugging process, but starting with such a highly detailed trace is not recommended. Analyzing a full function trace can be time consuming and confusing, especially if the latency&#039;s cause is complex. Additionally, function tracing has a significant overhead so it has a higher chance of affecting the behavior of the system. Because of this high overhead, in some cases it is possible that the targeted latency will not occur when function tracing is enabled.
</p>

<p>
Function tracing can be particularly useful for identifying latencies that are caused by the firmware or the hardware such as <a href="/realtime/documentation/howto/debugging/smi-latency/cyclictest-tracing" class="wikilink1" title="realtime:documentation:howto:debugging:smi-latency:cyclictest-tracing">SMI related latencies</a>. However, these kinds of latencies are not that common so it is not recommended to start by exploring this possibility.
</p>

</div>

<h2 class="sectionedit5" id="latency_tracing">Latency Tracing</h2>
<div class="level2">

<p>
There are a couple of steps that can help correctly produce a trace that includes the relevant latency. The following tips are relevant if the goal is to obtain a trace that includes the system&#039;s maximum latency. In general, it is a good idea to start by resolving the longest latencies in a system and to work down towards solving the shorter latencies.
</p>

<p>
Before tracing, make sure that the correct options for measuring the latency have been chosen and that Cyclictest detects the latency without having any tracing enabled. If the latency is not detected without any instrumentation, adding tracing will not help because the cause of the investigated latency will usually not be present in the resulting trace. Some suggestions for choosing the right Cyclictest options for a particular situation can be found on the Cyclictest <a href="/realtime/documentation/howto/tools/cyclictest/test-design#option-selection" class="wikilink1" title="realtime:documentation:howto:tools:cyclictest:test-design">Test Design</a> page.
</p>

</div>

<h3 class="sectionedit6" id="measuring_the_tracing_overhead">Measuring the Tracing Overhead</h3>
<div class="level3">

<p>
When trying to produce a trace that includes a specific latency, it is important to always adjust the break trace limit based on the observed tracing overhead. When tracing is enabled, the normal operation of the system will take longer and so the system&#039;s latencies will increase in length. For example, a system with an average latency of 1 us could have an average latency of 10 us with tracing enabled. If a maximum latency of around 130 us was observed without tracing, the maximum latency with tracing could be 200 us.
</p>

<p>
The easiest way to measure the overhead for a specific set of tracing instrumentation is to run Cyclictest with the desired tracing options and with a break trace limit that is much longer than the original maximum latency. Under these conditions, the new maximum latency measured with Cyclictest will include the original maximum latency and the tracing overhead.
</p>

<p>
For example, if the following Cyclictest command is run on a certain system:
</p>
<pre class="code bash">cyclictest <span class="re5">--mlockall</span> <span class="re5">--smp</span> <span class="re5">--priority</span>=<span class="nu0">80</span> <span class="re5">--interval</span>=<span class="nu0">200</span> <span class="re5">--distance</span>=<span class="nu0">0</span></pre>

<p>
and after a couple hours a maximum latency of 130 us is detected. To measure the value of the maximum latency with the overhead from function tracing, ftrace can be enabled and then the following Cyclictest command could be run:
</p>
<pre class="code bash">cyclictest <span class="re5">--mlockall</span> <span class="re5">--smp</span> <span class="re5">--priority</span>=<span class="nu0">80</span> <span class="re5">--interval</span>=<span class="nu0">200</span> <span class="re5">--distance</span>=<span class="nu0">0</span> <span class="re5">--breaktrace</span>=<span class="nu0">2000</span> <span class="re5">--tracemark</span></pre>

<p>
After a few hours a latency of 190 us is detected. The maximum latency observed during this overhead measuring test will be used to determine the appropriate break trace limit for tracing the original latency. This process is explained in the next section.
</p>

<p>
Since the intent of this step is just to observe the overhead, the break trace limit should be much longer than the length of the expected latencies and the tracing should never actually break. If the tracing does break, Cyclictest should be run again with a higher break trace limit. The magnitude of the increase of the maximum latency due to tracing depends on what generates the latency, so it is important to be critical and to make sure that the high latency has actually occurred and the suspected spike is not just an elevated baseline due to the tracing. If the latency spikes at a similar time or in a similar situation as before the tracing was enabled, it is a good sign that it is the same latency as before.
</p>

</div>

<h3 class="sectionedit7" id="producing_a_trace">Producing a Trace</h3>
<div class="level3">

<p>
Finally, a trace that includes the latency can be produced by starting ftrace and then running Cyclictest with a break trace limit that is slightly below the maximum latency value that was observed with tracing enabled. Continuing the example from the previous section, if the maximum latency with the overhead from function tracing is 190 us then the following command could be used to produce the trace:
</p>
<pre class="code bash">cyclictest <span class="re5">--mlockall</span> <span class="re5">--smp</span> <span class="re5">--priority</span>=<span class="nu0">80</span> <span class="re5">--interval</span>=<span class="nu0">200</span> <span class="re5">--distance</span>=<span class="nu0">0</span> <span class="re5">--breaktrace</span>=<span class="nu0">180</span> <span class="re5">--tracemark</span></pre>

<p>
using a break trace limit of 180 us. This new limit will cause Cyclictest to stop when the maximum latency occurs and will produce the relevant trace. This trace can then be viewed via tracefs in the same way as other Ftrace traces.
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>realtime/documentation/howto/tools/cyclictest/tracing.txt</bdi> · Last modified: 2022/01/19 20:01 by <bdi>bartwensley</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Page Tools</h3>
                <div class="tools">
                    <ul>
                        <li class="source"><a href="/realtime/documentation/howto/tools/cyclictest/tracing?do=edit" title="Show pagesource [v]" rel="nofollow" accesskey="v"><span>Show pagesource</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 9h5.5L13 3.5V9M6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m.12 13.5l3.74 3.74 1.42-1.41-2.33-2.33 2.33-2.33-1.42-1.41-3.74 3.74m11.16 0l-3.74-3.74-1.42 1.41 2.33 2.33-2.33 2.33 1.42 1.41 3.74-3.74z"/></svg></a></li><li class="revs"><a href="/realtime/documentation/howto/tools/cyclictest/tracing?do=revisions" title="Old revisions [o]" rel="nofollow" accesskey="o"><span>Old revisions</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M11 7v5.11l4.71 2.79.79-1.28-4-2.37V7m0-5C8.97 2 5.91 3.92 4.27 6.77L2 4.5V11h6.5L5.75 8.25C6.96 5.73 9.5 4 12.5 4a7.5 7.5 0 0 1 7.5 7.5 7.5 7.5 0 0 1-7.5 7.5c-3.27 0-6.03-2.09-7.06-5h-2.1c1.1 4.03 4.77 7 9.16 7 5.24 0 9.5-4.25 9.5-9.5A9.5 9.5 0 0 0 12.5 2z"/></svg></a></li><li class="backlink"><a href="/realtime/documentation/howto/tools/cyclictest/tracing?do=backlink" title="Backlinks" rel="nofollow"><span>Backlinks</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24m2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"/></svg></a></li><li class="menuitemfolded"><a href="javascript:void(0);" title="Fold/unfold all" rel="nofollow" class="fold_unfold_all_new" onclick="fold_unfold_all();"><span>Fold/unfold all</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M 2,0 L 6.5,3 L 2,6 z M 8,6.6 L 12.5,9.6 L 8,12.6 z M 14,13.2 L 20,13.2 L 17,17.7 z"/></svg></a></li><li class="top"><a href="#dokuwiki__top" title="Back to top [t]" rel="nofollow" accesskey="t"><span>Back to top</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Except where otherwise noted, content on this wiki is licensed under the following license: <bdi><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 4.0 International</a></bdi></div>
    <div class="buttons">
        <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license"><img src="/lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 4.0 International" /></a>        <a href="https://www.dokuwiki.org/donate" title="Donate" ><img
            src="/lib/tpl/dokuwiki/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="https://php.net" title="Powered by PHP" ><img
            src="/lib/tpl/dokuwiki/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="//validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="/lib/tpl/dokuwiki/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="//jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="/lib/tpl/dokuwiki/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="https://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="/lib/tpl/dokuwiki/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="/lib/exe/indexer.php?id=realtime%3Adocumentation%3Ahowto%3Atools%3Acyclictest%3Atracing&amp;1711222039" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>
</html>
