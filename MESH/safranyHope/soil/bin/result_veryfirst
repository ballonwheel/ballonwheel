

hahah :D, mukodik! a total szaraz: 3000korul van, a viz: 670 korul van, tehat, ha a ch1-en egy kaktusz van, akkor annak milyen ertek kellhet? imre@rpiz2w2:~/ballonwheel/MESH/safranyHope/soil/bin $ sudo ./soil_samplev2.sh 
[DEBUG] Measuring channel 0 (10 samples)...
[DEBUG] ch=0 raw=54 scale=3.000000000
[DEBUG] Sample 1 for ch0 = 162.000000
[DEBUG] ch=0 raw=1078 scale=3.000000000
[DEBUG] Sample 2 for ch0 = 3234.000000
[DEBUG] ch=0 raw=1078 scale=3.000000000
[DEBUG] Sample 3 for ch0 = 3234.000000
[DEBUG] ch=0 raw=1078 scale=3.000000000
[DEBUG] Sample 4 for ch0 = 3234.000000
[DEBUG] ch=0 raw=1078 scale=3.000000000
[DEBUG] Sample 5 for ch0 = 3234.000000
[DEBUG] ch=0 raw=1078 scale=3.000000000
[DEBUG] Sample 6 for ch0 = 3234.000000
[DEBUG] ch=0 raw=1078 scale=3.000000000
[DEBUG] Sample 7 for ch0 = 3234.000000
[DEBUG] ch=0 raw=1078 scale=3.000000000
[DEBUG] Sample 8 for ch0 = 3234.000000
[DEBUG] ch=0 raw=1078 scale=3.000000000
[DEBUG] Sample 9 for ch0 = 3234.000000
[DEBUG] ch=0 raw=1078 scale=3.000000000
[DEBUG] Sample 10 for ch0 = 3234.000000
[DEBUG] Avg for ch0 = 2926.800000
[DEBUG] Measuring channel 1 (10 samples)...
[DEBUG] ch=1 raw=1078 scale=3.000000000
[DEBUG] Sample 1 for ch1 = 3234.000000
[DEBUG] ch=1 raw=512 scale=3.000000000
[DEBUG] Sample 2 for ch1 = 1536.000000
[DEBUG] ch=1 raw=512 scale=3.000000000
[DEBUG] Sample 3 for ch1 = 1536.000000
[DEBUG] ch=1 raw=512 scale=3.000000000
[DEBUG] Sample 4 for ch1 = 1536.000000
[DEBUG] ch=1 raw=512 scale=3.000000000
[DEBUG] Sample 5 for ch1 = 1536.000000
[DEBUG] ch=1 raw=512 scale=3.000000000
[DEBUG] Sample 6 for ch1 = 1536.000000
[DEBUG] ch=1 raw=512 scale=3.000000000
[DEBUG] Sample 7 for ch1 = 1536.000000
[DEBUG] ch=1 raw=512 scale=3.000000000
[DEBUG] Sample 8 for ch1 = 1536.000000
[DEBUG] ch=1 raw=512 scale=3.000000000
[DEBUG] Sample 9 for ch1 = 1536.000000
[DEBUG] ch=1 raw=512 scale=3.000000000
[DEBUG] Sample 10 for ch1 = 1536.000000
[DEBUG] Avg for ch1 = 1705.800000


hah, kir√°ly! üëç A logb√≥l √∫gy t≈±nik, hogy a driver **scale=3.000000** (‚âà 3 mV/LSB), teh√°t az √©rt√©keid nagyj√°b√≥l **millivoltban** √©rtend≈ëk:

* teljesen sz√°raz \~**3000 mV**
* ‚Äúv√≠zben‚Äù \~**670 mV**

Ez pont az a karakterisztika, amit sok anal√≥g talajnedvess√©g szenzor ad: **sz√°raz ‚Üí nagy fesz**, **nedves ‚Üí kicsi fesz**.

# Gyors kalibr√°ci√≥ (a te sz√°maidra)

Haszn√°ljunk 2 pontos kalibr√°ci√≥t csatorn√°nk√©nt:

* `DRY_mV = 3000`
* `WET_mV = 670`
* Terjedelem: `SPAN = DRY_mV - WET_mV = 2330`

Defini√°ljunk ‚Äúnedvess√©g %-ot‚Äù √≠gy (0% = sz√°raz, 100% = nagyon nedves):

```
moist% = clamp( (DRY_mV - V) / SPAN * 100 , 0..100 )
```

ahol `V` az aktu√°lis m√©rt millivolt.

# Kaktusz (ch1) ‚Äì javasolt k√ºsz√∂b√∂k + hiszter√©zis

Kaktuszn√°l ink√°bb **nagyon sz√°raz** talaj kell, √≠gy alacsony k√ºsz√∂b√∂kkel dolgozunk:

* **√ñnt√∂z√©s ind√≠t√°s**: ha `moist% < ~12%`  ‚Üí ez kb. **V ‚â• 2720 mV**
* **√ñnt√∂z√©s le√°ll√≠t√°s**: ha `moist% ‚â• ~28%` ‚Üí ez kb. **V ‚â§ 2350 mV**

Sz√°mol√°s:

* 12%: `V_start = DRY - 0.12*SPAN = 3000 - 0.12*2330 ‚âà 2720 mV`
* 28%: `V_stop  = DRY - 0.28*SPAN = 3000 - 0.28*2330 ‚âà 2350 mV`

√çgy nem fog ‚Äúcicergeni‚Äù (be-ki kapcsolgatni), mert van **hiszter√©zis** (2720 ‚Üî 2350 mV).

# Bash beilleszt√©s (ch1-hez)

Dobj be egy kis seg√©df√ºggv√©nyt a skriptbe, √©s a d√∂nt√©st is logold:

```bash
# kalibr√°ci√≥ ‚Äì csatorn√°nk√©nt √©rdemes k√ºl√∂n f√°jlban tartani
DRY_1=3000
WET_1=670
SPAN_1=$((DRY_1 - WET_1))  # 2330

moist_pct_ch1() {
  local v_mV="$1"
  python3 - <<PY
dry=$DRY_1; wet=$WET_1; span=$SPAN_1; v=$v_mV
pct = max(0.0, min(100.0, (dry - v) / span * 100.0))
print(f"{pct:.1f}")
PY
}

decide_cactus_ch1() {
  local v_mV="$1"
  local start=2720  # ~12%
  local stop=2350   # ~28%
  if (( v_mV >= start )); then
    echo "WATER_ON"   # t√∫l sz√°raz -> ind√≠ts
  elif (( v_mV <= stop )); then
    echo "WATER_OFF"  # el√©g nedves -> √°llj le
  else
    echo "KEEP_STATE" # hiszter√©zis z√≥na
  fi
}
```

Haszn√°lat a m√©r√©s ut√°n:

```bash
v1_mV=$(printf "%.0f\n" "$v1")  # kerek√≠ts mV-ra
p1=$(moist_pct_ch1 "$v1_mV")
act=$(decide_cactus_ch1 "$v1_mV")
>&2 echo "[DEBUG] ch1 cactus: V=${v1_mV}mV  moist=${p1}%  action=${act}"
```

# P√°r fontos megjegyz√©s

* **Szenzoronk√©nt kalibr√°lj!** Ugyanazon t√≠pusn√°l is lehet elt√©r√©s. A fenti DRY/WET j√≥ kiindul√≥, de √©rdemes **azonos cser√©p, azonos f√∂ld** mellett bem√©rni.
* **Nedves ‚â† v√≠zben:** a 670 mV ‚Äúv√≠zben‚Äù √©rt√©k alacsonyabb, mint a re√°lis ‚Äúnedves f√∂ld‚Äù. Emiatt a val√≥s 100% f√∂ldnedvess√©g k√∂zelebb lesz mondjuk 900‚Äì1200 mV-hoz. Ha van t√ºrelmed, adj meg egy **WET\_SOIL** pontot is, √©s arra kalibr√°lj.
* **Sz≈±r√©s:** j√≥ √∂tlet a mostani 10 mint√°s √°tlag, plusz √©rdemes **medi√°nt** venni az esetleges t√ºsk√©k ellen (ha kell, adok gyors median filtert Bash/Pythonba).
* **Id≈ëtartam-felt√©tel:** praktikus, ha az ‚Äúind√≠t√°s/le√°ll√≠t√°s‚Äù felt√©tel **N egym√°st k√∂vet≈ë cikluson** is fenn√°ll (pl. 5‚Äì10 perc), √≠gy a zaj nem billent √°t.

Ha szeretn√©d, √°talak√≠tom a teljes skriptet √∫gy, hogy **per-csatorna kalibr√°ci√≥s INI/CSV**-b≈ël olvassa a `DRY/WET` √©rt√©keket √©s a k√ºsz√∂b√∂ket, √©s kinyom egy **WATER\_ON/OFF** d√∂nt√©st GPIO-ra (m√°gnesszelep).




vitorla viragra ugyanezt, kerlek ch0-n : imre@rpiz2w2:~/ballonwheel/MESH/safranyHope/soil/bin $ sudo ./soil_samplev2.sh 
[DEBUG] Measuring channel 0 (10 samples)...
[DEBUG] ch=0 raw=54 scale=3.000000000
[DEBUG] Sample 1 for ch0 = 162.000000
[DEBUG] ch=0 raw=229 scale=3.000000000
[DEBUG] Sample 2 for ch0 = 687.000000
[DEBUG] ch=0 raw=242 scale=3.000000000
[DEBUG] Sample 3 for ch0 = 726.000000
[DEBUG] ch=0 raw=251 scale=3.000000000
[DEBUG] Sample 4 for ch0 = 753.000000
[DEBUG] ch=0 raw=259 scale=3.000000000
[DEBUG] Sample 5 for ch0 = 777.000000
[DEBUG] ch=0 raw=265 scale=3.000000000
[DEBUG] Sample 6 for ch0 = 795.000000
[DEBUG] ch=0 raw=271 scale=3.000000000
[DEBUG] Sample 7 for ch0 = 813.000000
[DEBUG] ch=0 raw=276 scale=3.000000000
[DEBUG] Sample 8 for ch0 = 828.000000
[DEBUG] ch=0 raw=280 scale=3.000000000
[DEBUG] Sample 9 for ch0 = 840.000000
[DEBUG] ch=0 raw=284 scale=3.000000000
[DEBUG] Sample 10 for ch0 = 852.000000
[DEBUG] Avg for ch0 = 723.300000




szupi! a ch0 √°tlag **\~723 mV**, ami a mi (durva) DRY=3000 / WET=670 sk√°l√°n **nagyon nedves** (kb. 98%).
A **vitorlavir√°g** (Spathiphyllum) szereti a folyamatosan **enyh√©n nedves** k√∂zeget, de a ‚Äûtocsog√≥s‚Äù √°llapot gy√∂k√©rrothad√°st okozhat. √Åll√≠tsunk be konzervat√≠v hiszter√©zist:

* **√ñnt√∂z√©s ind√≠t√°s (sz√°razodik):** `V_start ‚âà 2115 mV` (‚âà 38% nedvess√©g)
* **√ñnt√∂z√©s le√°ll√≠t√°s (el√©g nedves):** `V_stop  ‚âà 1510 mV` (‚âà 64% nedvess√©g)

A mostani **723 mV** ez al√° esik ‚Üí **OFF** (ne √∂nt√∂zz).

### Bash kieg√©sz√≠t√©s ch0-ra (vitorlavir√°g)

Dobd ezeket a f√ºggv√©nyeket a scriptedbe (a ch1-kaktusz mell√©), √©s h√≠vd meg a m√©r√©s ut√°n:

```bash
# --- ch0: vitorlavir√°g kalibr√°ci√≥ ---
DRY_0=3000
WET_0=670
SPAN_0=$((DRY_0 - WET_0))  # 2330

moist_pct_ch0() {
  local v_mV="$1"
  python3 - <<PY
dry=$DRY_0; wet=$WET_0; span=$SPAN_0; v=$v_mV
pct = max(0.0, min(100.0, (dry - v) / span * 100.0))
print(f"{pct:.1f}")
PY
}

# vitorlavir√°g: enyh√©n nedves tartom√°nyt c√©lzunk
decide_spathiphyllum_ch0() {
  local v_mV="$1"
  local start=2115   # ~38% -> sz√°razodik, induljon az √∂nt√∂z√©s
  local stop=1510    # ~64% -> m√°r el√©g nedves, √°lljon le
  if (( v_mV >= start )); then
    echo "WATER_ON"
  elif (( v_mV <= stop )); then
    echo "WATER_OFF"
  else
    echo "KEEP_STATE"  # hiszter√©zis s√°v
  fi
}
```

Haszn√°lat a m√©r√©sek ut√°n:

```bash
v0_mV=$(printf "%.0f\n" "$v0")
p0=$(moist_pct_ch0 "$v0_mV")
act0=$(decide_spathiphyllum_ch0 "$v0_mV")
>&2 echo "[DEBUG] ch0 vitorlavirag: V=${v0_mV}mV  moist=${p0}%  action=${act0}"
```

#### Tipp (k√©s≈ëbb finomhangol√°s)

A WET=670 mV ‚Äûv√≠zben‚Äù pont nagyon alacsony; a **‚Äúj√≥ nedves f√∂ld‚Äù** sokszor ink√°bb **900‚Äì1200 mV** k√∂r√ºl van. Ha lesz kedved, m√©rj egy **WET\_SOIL** pontot (pl. alapos √∂nt√∂z√©s ut√°n 30‚Äì60 perccel), √©s arra hangoljuk a sz√°zal√©kot/k√ºsz√∂b√∂ket m√©g pontosabbra.






